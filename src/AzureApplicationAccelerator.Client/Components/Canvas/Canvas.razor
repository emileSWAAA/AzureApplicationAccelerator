@using AzureApplicationAccelerator.Components.Elements.Shared
@using AzureApplicationAccelerator.Elements.Models.Elements
@inject UIDefinitionService DefinitionService

<div class="sortable-container">
    <FluentSortableList Id="canvas"
                        Group="elementList"
                        Items="@DefinitionService.ActiveStep?.Elements"
                        OnUpdate="@SortList"
                        Clone="true"
                        Handle="true"
                        Style="overflow-y:auto; max-width:100%; min-height:80vh; max-height:80vh;">
        <ItemTemplate>
            <CanvasItem Element="@context" @key="@context.Id" />
        </ItemTemplate>
    </FluentSortableList>
</div>

@code {
    protected override void OnInitialized()
    {
        DefinitionService.OnChange += StateHasChanged;
    }

    private async Task SortList(FluentSortableListEventArgs args)
    {
        if (args is null || args.OldIndex == args.NewIndex) return;

        var oldIndex = args.OldIndex;
        var newIndex = args.NewIndex;
        var oldElement = DefinitionService.ActiveStep.Elements[oldIndex];
        var newElement = DefinitionService.ActiveStep.Elements[newIndex];

        await DefinitionService.SwapElements(oldElement.Id, newElement.Id);
    }
}
