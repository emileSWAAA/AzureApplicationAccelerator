@using System.Text.Json
@using AzureApplicationAccelerator.Elements.Converters
@inject UIDefinitionService DefinitionService

<pre >@DefinitionJson</pre>

@code {
    public string DefinitionJson { get; set; }

    protected override void OnInitialized()
    {
        UpdateDefinitionJson();
        DefinitionService.OnChange += HandleDefinitionManagerChange;
    }

    private void HandleDefinitionManagerChange()
    {
        UpdateDefinitionJson();
        StateHasChanged();
    }

    private void UpdateDefinitionJson()
    {
        DefinitionJson = JsonSerializer.Serialize(DefinitionService.Definition, new JsonSerializerOptions
        {
            WriteIndented = true,
            PropertyNamingPolicy = JsonNamingPolicy.CamelCase,
            DefaultIgnoreCondition = System.Text.Json.Serialization.JsonIgnoreCondition.WhenWritingNull,
            Converters = { new UIElementJsonConverter() }
        });
    }

    public void Dispose()
    {
        DefinitionService.OnChange -= HandleDefinitionManagerChange;
    }
}
